<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>가게 연구 시스템 프로토타입</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  font-family: system-ui;
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
}

/* overlay */
.overlay {
  position: fixed;
  inset: 0;
  display: flex;
  justify-content: center;
  align-items: center;
}

/* 최초 팝업 */
.popup-main {
  width: 360px; height: 260px;
  border: 3px solid #000;
  background: #0f607a;
  position: relative;
  padding: 20px;
}

.btn {
  border: 2px solid #000;
  background: #f7d9c7;
  cursor: pointer;
  text-align: center;
}

.btn-disabled {
  opacity: .5;
  pointer-events: none;
}

.btn-start {
  position: absolute;
  top: 40px; left: 50%;
  width: 220px; height: 70px;
  transform: translateX(-50%);
  font-size: 20px;
  display: flex; justify-content: center; align-items: center;
}

.left-box {
  position: absolute;
  left: 32px; bottom: 40px;
  border: 2px solid #000;
}

.label-research {
  padding: 4px 0;
  font-size: 12px;
  background: #f7d9c7;
  border-bottom: 2px solid #000;
  cursor: pointer;
}

.storage-disabled {
  width: 96px;
  padding: 10px 0;
  font-size: 18px;
  background: #f7d9c7;
  opacity: .5;
}

.btn-exit-main {
  position: absolute;
  right: 32px; bottom: 72px;
  width: 90px; height: 40px;
  display: flex; justify-content: center; align-items: center;
}

/* 연구 팝업 */
.popup-research {
  display: none;
  width: 800px;
  padding: 20px;
  border: 2px solid #000;
  background: #fff0e7;
  border-radius: 12px;
  flex-direction: column;
  gap: 14px;
}

.research-title {
  font-size: 20px;
  font-weight: 700;
  text-align: center;
}

/* 레벨 선택 */
.level-select {
  display: flex;
  justify-content: center;
  gap: 6px;
  margin-bottom: 10px;
}

.level-btn {
  border: 2px solid #000;
  padding: 4px 8px;
  cursor: pointer;
  font-size: 13px;
  background: #fff;
}

.level-btn.active {
  background: #ffd06e;
}

/* 노드 스크롤 */
.node-scroll {
  width: 100%;
  border: 2px solid #000;
  background: #f7dcd1;
  padding: 18px;
  overflow-x: auto;
}

.node-track {
  display: flex;
  gap: 40px;
  min-width: 850px;
  align-items: center;
}

.node-wrapper {
  width: 140px;
  border: 2px solid #000;
  background: #cfcfcf;
  text-align: center;
  cursor: pointer;
  opacity: .35; /* 기본: 비활성 */
}

.node-wrapper.unlocked {
  opacity: 1; /* 레벨 해금 */
}

.node-wrapper.active {
  background: #ade9b5; /* 레시피 */
}

.node-wrapper.equip.active {
  background: #b6d7ff; /* 장비 */
}

.node-title {
  padding: 10px;
  font-size: 15px;
}

/* 조건 */
.condition-bar {
  padding: 6px;
  font-size: 13px;
  border-top: 2px solid #000;
  background: #ddd;
  cursor: pointer;
}

.condition-bar.met {
  background: #cfe1ff; /* 조건 충족 */
}

/* 팝업 하단 */
.research-bottom-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.store-level {
  background: #1b1b1b;
  color: #fff;
  padding: 6px 12px;
  border-radius: 6px;
}

.btn-research-exit {
  padding: 8px 12px;
  border-radius: 6px;
  background: #444;
  color: #fff;
  cursor: pointer;
}

/* 조건 팝업 */
.modal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.3);
  justify-content: center;
  align-items: center;
}

.modal-content {
  padding: 14px 18px;
  border: 2px solid #000;
  background: #fff;
  border-radius: 8px;
  min-width: 260px;
}

.modal-close {
  position: absolute;
  right: 10px; top: 6px;
  cursor: pointer;
}
</style>
</head>
<body>

<div class="overlay">

  <!-- 최초 -->
  <div id="mainPopup" class="popup-main">
    <div class="btn btn-start btn-disabled">가게 운영 시작</div>

    <div class="left-box">
      <div id="btnOpenResearch" class="label-research">가게 연구</div>
      <div class="storage-disabled">창고</div>
    </div>

    <div class="btn btn-exit-main btn-disabled">나가기</div>
  </div>


  <!-- 연구 팝업 -->
  <div id="researchPopup" class="popup-research">
    <div class="research-title">가게 연구</div>

    <!-- 레벨 선택 -->
    <div class="level-select">
      <div class="level-btn active" data-level="1">Lv1</div>
      <div class="level-btn" data-level="2">Lv2</div>
      <div class="level-btn" data-level="3">Lv3</div>
      <div class="level-btn" data-level="4">Lv4</div>
      <div class="level-btn" data-level="5">Lv5</div>
    </div>

    <!-- 노드 트랙 -->
    <div class="node-scroll">
      <div class="node-track" id="nodeTrack">

        <!-- Lv1 - 레시피 -->
        <div class="node-wrapper recipe unlocked active"
          data-node-level="1"
          data-node-name="불고기 버거"
          data-condition="시작 노드입니다.">
          <div class="node-title">불고기 버거</div>
          <div class="condition-bar met">조건</div>
        </div>

        <!-- Lv2 - 레시피 -->
        <div class="node-wrapper recipe"
          data-node-level="2"
          data-node-name="치즈 버거"
          data-condition="Lv1 연구 완료 시 해금">
          <div class="node-title">치즈 버거</div>
          <div class="condition-bar">조건</div>
        </div>

        <!-- Lv3 - 레시피 -->
        <div class="node-wrapper recipe"
          data-node-level="3"
          data-node-name="새우 버거"
          data-condition="Lv2 연구 완료 시 해금">
          <div class="node-title">새우 버거</div>
          <div class="condition-bar">조건</div>
        </div>


        <!-- Lv2 - 장비 -->
        <div class="node-wrapper equip"
          data-node-level="2"
          data-node-name="자동 조리기"
          data-condition="Lv1 연구 완료 시 해금">
          <div class="node-title">자동 조리기</div>
          <div class="condition-bar">조건</div>
        </div>

        <!-- Lv3 - 장비 -->
        <div class="node-wrapper equip"
          data-node-level="3"
          data-node-name="자동 서빙기"
          data-condition="Lv2 연구 완료 시 해금">
          <div class="node-title">자동 서빙기</div>
          <div class="condition-bar">조건</div>
        </div>

        <!-- Lv4 - 장비 -->
        <div class="node-wrapper equip"
          data-node-level="4"
          data-node-name="재료 자동주문"
          data-condition="Lv3 연구 완료 시 해금">
          <div class="node-title">재료 자동주문</div>
          <div class="condition-bar">조건</div>
        </div>

      </div>
    </div>

    <!-- 바닥 -->
    <div class="research-bottom-row">
      <div class="store-level" id="storeLevelLabel">가게 레벨: 1</div>
      <div id="btnBackToMain" class="btn-research-exit">나가기</div>
    </div>
  </div>

</div>

<!-- 조건 팝업 -->
<div id="nodeConditionModal" class="modal">
  <div class="modal-content">
    <div id="modalClose" class="modal-close">✕</div>
    <div id="modalConditionText"></div>
  </div>
</div>

<script>
const mainPopup = document.getElementById("mainPopup");
const researchPopup = document.getElementById("researchPopup");
const nodeTrack = document.getElementById("nodeTrack");
const storeLevelLabel = document.getElementById("storeLevelLabel");

// 팝업 이동
document.getElementById("btnOpenResearch").onclick = () => {
  mainPopup.style.display = "none";
  researchPopup.style.display = "flex";
};

// 나가기
document.getElementById("btnBackToMain").onclick = () => {
  researchPopup.style.display = "none";
  mainPopup.style.display = "block";
};

// 레벨 선택
const levelBtns = document.querySelectorAll(".level-btn");
levelBtns.forEach(btn => {
  btn.onclick = () => {
    levelBtns.forEach(b => b.classList.remove("active"));
    btn.classList.add("active");

    const level = parseInt(btn.dataset.level);
    storeLevelLabel.textContent = `가게 레벨: ${level}`;
    updateNodeUnlock(level);
  };
});

const nodes = document.querySelectorAll(".node-wrapper");
const modal = document.getElementById("nodeConditionModal");
const modalText = document.getElementById("modalConditionText");
const modalClose = document.getElementById("modalClose");

// 노드 클릭 : 활성 토글 + 팝업
nodes.forEach(node => {
  node.addEventListener("click", e => {
    if (!node.classList.contains("unlocked")) return;

    node.classList.toggle("active");

    modalText.textContent = node.dataset.condition;
    modal.style.display = "flex";
    e.stopPropagation();
  });
});

// 조건 클릭: 파란색 토글
const conditions = document.querySelectorAll(".condition-bar");
conditions.forEach(cond => {
  cond.onclick = e => {
    if (!cond.parentElement.classList.contains("unlocked")) return;
    cond.classList.toggle("met");
    e.stopPropagation();
  };
});

// 팝업 닫기
modalClose.onclick = () => modal.style.display = "none";
modal.onclick = (e) => { if (e.target === modal) modal.style.display = "none"; };


// ▶ 핵심: 레벨별 해금 로직
function updateNodeUnlock(level) {
  nodes.forEach(node => {
    const req = parseInt(node.dataset.nodeLevel);
    if (req <= level) {
      node.classList.add("unlocked");
    } else {
      node.classList.remove("unlocked", "active");
      node.querySelector(".condition-bar").classList.remove("met");
    }
  });
}

updateNodeUnlock(1);
</script>
</body>
</html>
